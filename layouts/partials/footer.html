{{ $p := .data }}
{{ $c := .context }}
{{ $isServer := .isServer }}
{{ $testProd := .testProd }}
{{ $mediaPage := $c.Site.GetPage "page" "media/index.md"}}

	<!-- Footer -->
	{{ if eq $c.RelPermalink "/" }}
		<div id="footer">
			<div class="container">
				<div class="row">
					<!-- Tweets -->
						<section class="6u 12u(mobile)" id="twitter">
							<header>
								<h2 class="icon fa-twitter circled"><span class="label">{{ $p.Params.miniprojects_title }}</span></h2>
							</header>
							<ul class="divided tweets">

							</ul>
						</section>

					<!-- Miniprojects -->
						<section class="6u 12u(mobile)" id="projects">
							<header>
								<a href="http://github.com/davidayalas" title="Mini projects, mini utilities"><h2 class="icon fa-file circled"><span class="label">{{ $p.Params.miniprojects_title }}</span></h2></a>
							</header>
							<ul class="divided">
								{{ range $p.Params.miniprojects }}
								<li><article class="post stub"><header><h3><a href="{{ .link }}" class="notranslate">{{ .title }}</a></h3></header><p>{{ safeHTML (markdownify .description) }}</p></article></li>
								{{ end }}
							</ul>
							<footer>
								<a href="https://github.com/davidayalas?tab=repositories" class="button">More miniprojects</a>
							</footer>
						</section>
				</div>
			</div>
		</div>

	<!-- Main -->
		{{ if and (isset $p.Params "architecture_title") (ne (string $p.Params.architecture_title) "") }}
		<div class="style2" style="background: #ddd; padding-top:1em; padding-bottom:2em">
			<article id="architecture" class="container special">
				<header>
					<h2>{{ $p.Params.architecture_title }}</h2>
				</header>
				<img data-src="{{ $p.Params.architecture_diagram }}" class="diagram lozad" alt="architecture diagram" />
			</article>
		</div>
		{{ end }}
	{{ end }}

	{{ if eq $c.Permalink "/" }}
		<div class="contact style3">
			<div class="container" >
				<header>
					<h2>{{ $p.Params.contact_title }}</h2>
				</header>				
				<form action="/thanks" name="contact" class="10u 12u(mobile)" netlify>
					<div class="row">
						<div class="6u 12u(mobile)"><input type="text" name="name" placeholder="Name" required /></div>
						<div class="6u 12u(mobile)"><input type="email" name="email" placeholder="Email"  required /></div>
					</div>
					<div class="12u"><textarea name="message" placeholder="Message" required></textarea></div>
				    <div data-netlify-recaptcha></div>
					<div class="col-12">
						<ul class="actions special">
							<li><input type="submit" class="button" value="Send" /></li>
							<li><input type="reset" class="button alt" value="Reset" /></li>
						</ul>
					</div>
				</form>

			</div>
		</div>
	{{ end }}
		
		<div class="footer">
			<div class="container">
				<div class="row">
					<div class="12u">
						<!-- Copyright -->
							<div class="copyright">
								<span class="notranslate">Powered By: </span>
								<a href="http://gohugo.io/"><img data-src="/images/hugo.png" title="Hugo" alt="Hugo" class="ico lozad" /></a>
								<a href="https://www.netlify.com/"><img data-src="/images/netlify.ico" title="Netlify" alt="Netlify" class="ico lozad" /></a>
								<a href="https://github.com/"><img data-src="/images/github2.png" alt="Github" title="Github" class="ico lozad" /></a> 
								<a href="https://developers.google.com/apps-script/"><img data-src="/images/gas.png" title="Google Apps Script" alt="Google Apps Script" class="ico lozad" /></a>
								<br />
								Design: <a href="https://html5up.net/helios">HTML5 UP</a>
								<br />
								<a href="https://lighthouse-dot-webdotdevsite.appspot.com/lh/html?url=https://www.davidayala.eu"><img data-src="/images/webdev.svg" title="Web.dev performance report" alt="Web.dev performance report" class="lozad webdev" /></a>

							</div>

						<!-- Edit -->
							<div class="pull-right editpage">
								{{ if eq $c.RelPermalink "/" }}
								<a href="/admin/#/collections/home/entries/home"><i class="fa fa-pencil" aria-hidden="true"></i> Edit this page</a> &nbsp;
								{{ end }}

								<a href="/admin/#/collections/gallery/new"><i class="fa fa-plus" aria-hidden="true"></i> Add new image</a>
							</div>
					</div>
				</div>
			</div>
		</div>
</div>


<!-- Scripts -->
{{ if (eq .isServer true) }}
<script type="text/javascript">
	function createCSS(pathCSS){
		var linkSS = document.createElement('link');
		linkSS.rel = 'stylesheet';
		linkSS.href = pathCSS;
		linkSS.type = 'text/css';
		var head = document.getElementsByTagName('head')[0];
		head.insertBefore(linkSS, head.childNodes[0]);		
	}

	//createCSS("/assets/css/style.css");
	createCSS("/assets/css/main.css");
	createCSS("/assets/css/font-awesome.min.css");
	//createCSS("https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400,400italic,600");

</script>
{{ end }}

<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous" defer></script>

{{if $p.Params.header}}
	{{ $image := $mediaPage.Resources.GetMatch (replace $p.Params.header "/media/" "") }}
	{{ $c.Scratch.Set "header" ($image.Resize (print $image.Width "x" $image.Height " q60")) }}
	{{ if gt $image.Width 1600 }}
		{{ $c.Scratch.Set "header" ($image.Resize "1600x q75") }}
	{{ end }}

<script defer>
	var headerImage = '{{ ($c.Scratch.Get "header").RelPermalink }}';
	{{ if (eq .isServer false) }}
		var img = new Image();
		img.onload = function() {
			hasWebP = !!(img.height > 0 && img.width > 0);
			headerImage = headerImage + ".webp";
			var images = document.getElementsByTagName("img");
			for (var i = 0, z=images.length; i<z; i++){
				 if(images[i].getAttribute("data-src").indexOf("/media/")===-1){
					images[i].setAttribute("data-src",images[i].getAttribute("data-src")+".webp");
					console.log(images[i].getAttribute("data-src")); //second console output
				 }
			}			
		};
		img.onerror = function() {
			hasWebP = false;
		};
		img.src = 'data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=';
	{{ end }}
</script>
{{end }}

<script src="https://identity.netlify.com/v1/netlify-identity-widget.js" defer></script>
<!--script src="/assets/js/jquery.min.js" defer></script-->
<!--script src="/assets/js/jquery.dropotron.min.js" defer></script-->
<!--script src="/assets/js/jquery.scrolly.min.js" defer></script-->
<!--script src="/assets/js/jquery.onvisible.min.js" defer></script--> 
<script src="/assets/js/skel.min.js" defer></script>
<script src="/assets/js/util.js" defer></script>
<!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js" defer></script><![endif]-->
<script src="/assets/js/main.js" defer></script>
<script src="/js/custom.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>

<script defer>
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on("init", user => {
      if (!user) {
        window.netlifyIdentity.on("login", () => {
          document.location.href = "/admin/#/collections/home/entries/home";
        });
      }
    });
  }

  try{
	const observer = window.lozad();
	observer.observe();  
  }catch(e){}
</script> 
